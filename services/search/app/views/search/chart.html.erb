<%= stylesheet_link_tag "jqplot/jquery.jqplot"%>
<%= javascript_include_tag "jqplot/jquery.jqplot","jqplot/jqplot.categoryAxisRenderer","jqplot/jqplot.barRenderer","jqplot/jqplot.cursor"%>

<script type="text/javascript">
	var data 		=	'<%=@json%>';
	var unescaped 	=	$('<textarea />').html(data).val();
	var json		=	jQuery.parseJSON(unescaped);
	var length		=	json.length;
	var min_day		=	0;
	var max_day		=	0;
	
	for (i = 0; i < length; i++){
		if (min_day == 0 || min_day > json[i]['Calendar Day']){
			min_day		=	json[i]['Calendar Day']
		}
		if (max_day < json[i]['Calendar Day']){
			max_day		=	json[i]['Calendar Day']
		}
	}
		
	json.sort(sortBy("Calendar Day"));
	
	for (i = 0; i < 10; i++){
		eval("list" + i + " = new Array();");
	}
	
	day_key		=	new Array();
	day_val		=	new Array();
	key 		=	0;
	min_day		=	138;
	max_day		=	150;
	for(i = min_day; i <= max_day; i++){
		day_key[i]		=	key;
		day_val[key]	=	i;
		for (j = 0; j < 10; j++){
			eval("list" + j + "[" + key + "] = 0;");
		}
		key++;
	}
	
	var cal_day		=	0;
	for (i = 0; i < length; i++){
		if (json[i]['Calendar Day'] >= min_day && json[i]['Calendar Day'] <= max_day){
			for (j = 0; j < 10; j++){
				if (eval("list" + j + "[" + day_key[json[i]['Calendar Day']] + "]") == 0){
					eval("list" + j + "[" + day_key[json[i]['Calendar Day']] + "] = " + json[i]['Biometeorological Time'] + ";");
					break;
				}
			}	
		}
	}
	
function sortBy(prop){ return function(a,b){return a[prop]-b[prop];}}
	
$.jqplot.config.enablePlugins = true;
$(document).ready(function(){

	bars		=	new Array();
	lseries		=	new Array();
	for (j = 0; j < 10; j++){
		lseries[j]	=	new Array();
		bars[j]	=	eval("list" + j);
		lseries[j]['label']		=	'Datset ' + j+1;
		lseries[j]['renderer']	=	$.jqplot.BarRenderer; 
	}
	
	plot1 = $.jqplot('chart1', bars, {
	    legend:{show:true, location:'ne'},title:'WEHub',
	    series:lseries,
	    axes:{
	        xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks: day_val}, 
	        yaxis:{min:0}
	    },
		cursor:{
			zoom:true,
	    	showTooltip: false
		}
	});
	controlplot1 = $.jqplot('chart2', bars, {
	    legend:{show:false, location:'ne'},title:'',
	    series:'',
	    axesDefaults:{
		    tickOptions:{
		      showLabel:false, 
		      showMark:false
		    }
		},
		cursor:{
			zoom:true,
	    	showTooltip: false
		}
	});
	$.jqplot.Cursor.zoomProxy(plot1,controlplot1);  
});
</script>


<div id="chart1" class="plot" style="width:1000px;height:560px;"></div>
<div id="chart2" class="plot" style="width:1000px;height:60px;"></div>