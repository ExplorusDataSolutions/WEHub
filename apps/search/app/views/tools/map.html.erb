<script>
  $(document).ready(function() {

    var lon = 5;
    var lat = 40;
    var zoom = 5;
    var map, layer;

    map = new OpenLayers.Map( 'map' );
    layer = new OpenLayers.Layer.WMS( "OpenLayers WMS", "http://labs.metacarta.com/wms/vmap0", {layers: 'basic'} );
    map.addLayer(layer);
    
            
    function drawJSON(data, colour) {
      var geojson_format = new OpenLayers.Format.GeoJSON();
      var vector_layer = new OpenLayers.Layer.Vector(); 

      var style = OpenLayers.Feature.Vector.style["default"];
      style.strokeColor = style.fillColor = colour;

      vector_layer.style = style;
            
      map.addLayer(vector_layer);
      vector_layer.addFeatures(geojson_format.read(data));

      var bounds = new OpenLayers.Bounds(
        -119.193, 48.999,
        -110.006, 59.858
      );
      map.zoomToExtent(bounds);
    }

    var points = [];
    <% 
      @datasets.each_with_index do |dataset, i|
    %>
    points.push(<%= "'POINT(#{dataset.coordinates.gsub(',',' ')})'" %>);
    $.get(<%= "'http://localhost:3001/api/feature/#{dataset.id}?output=json'" -%>, function(data) { drawJSON(data, <%= "'#{css_colour(i)[:code]}'" %>); }); 
    <%
      end unless !@datasets
    %>
/*
    var centriod = OpenLayers.Geometry.fromWKT(points);
debugger;
*/
  });    
</script>
	
<div class="tab-menu-body">
	<div class="tab-menu tab-menu-select">
		<%= link_to 'WE Data Map', :controller => 'tools', :action => 'map', :id => @id %>
	</div>
	<div class="tab-menu">
		<%= link_to 'WE Data Graphs', :controller => 'tools', :action => 'chart', :id => @id %>
	</div>
	<div class="tab-menu">
		<%= link_to 'Developers', :controller => 'tools', :action => 'developers', :id => @id %>
	</div>
	<div class="tab-menu-right">
		<div class="top-container-tab">
			<div class="float-left tab-download">Download</div><div class="float-left tab-download-arrow"></div>
		</div>
	</div>
</div>
<div class="clear"></div>
<style>
  #filter-container ul {
    padding: 0px;
    margin: 0 -6px 0 20px;
  }
  #filter-container li {
    font-size: 30px;
    line-height: 18px;
  }
</style>
<div class="sub-content-body">
	<div class="sub-content-left">
<%
=begin %<	
		<div class="left-tab-body">
			<div id="bar-chart-div" class="left-tab tab-select">
				<a href="#">Layers</a>
			</div>
			<div id="line-chart-div" class="left-tab">
				<a href="#">Info</a>
			</div>
		</div>
		<div class="clear"></div>
<%
=end %>		
		<div id="filter-container">
      <div id="filter-content">
      <%= form_for :datasets do |f| %>
      <%  @datasets.each_with_index do |dataset,i| %>
        <div class="float-left">
          <%= check_box_tag "dataset[#{dataset.id}]", dataset.id %>
        </div>
        <div class="float-left width-5">&nbsp;</div>
        <div class="float-left"><ul><li style='color: <%= "#{css_colour(i)[:code]}" %>'></li></ul></div>
        <div class="float-left width-5">&nbsp;</div>
        <div class="float-left width-210">
          <label for='<%= "dataset_#{dataset.id}" %>'>
            <div class="tool-left-link">
            <%= dataset.name %>
            </div>
            <div class="tool-left-text">
            <%= dataset.description %>
            </div>
          </label>
        </div>
        <div class="clear height-5">&nbsp;</div>
      <% end unless !@datasets %>
      <% end %>
      </div>

      <div class="clear height-50">&nbsp;</div>
      <div>
<%
=begin %>      
        <span class="button">
          <button onclick="add_new_dataset_map(); return false;">+ Dataset</button>
        </span>
<%
=end %>        
        <span class="button">
          <button onclick="remove_dataset_map(); return false;">Remove</button>
        </span>				
      </div>					
		</div>
	</div>
	<input type="hidden" name="hid_last_cnt" id="hid_last_cnt" value="4">
	<div class="sub-content-center">
		<div id="map" style="width:564px;"></div>
		<!--img src="/images/temp-data-map.jpg" border="0" alt="Temp Map" title="Map"-->		
	</div>
	<div class="sub-content-right">
    <%= render 'shared/right_panel' %>		
	</div>
	<div class="clear"></div>
</div>
